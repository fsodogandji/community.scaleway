- name: secret-manager test
  hosts: localhost
  vars:
    secret_id: "2017b507-1d3e-4ac2-8f16-61bf903b5a63"
    secret_name: "unit_test-create-secret"
    password_length: 12
    password_specs:
    - digits
    - ascii_lowercase
    - ascii_uppercase
    - digits
    - printable
  tasks:
  - name: password generation
    set fact:
      secret_data: "{{ secret_data | default([]) + [lookup('password', '/dev/null length=1 chars=' ~item)]}}"
    loop: "{{ password_specs }}"

  - name: create a secret version from an existing secret`
    create_secret_version:
      secret_id:  "{{ secret_id }}"
      secret_data: "{{ secret_data }}" 
    register: output
  - name: dump test output
    debug:
      var: output.message